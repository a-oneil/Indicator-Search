<script>
  function CopyTextToClipboard(text) {
    // Create a temporary textarea element to hold the text
    var tempTextarea = document.createElement("textarea");
    tempTextarea.value = text;

    // Append the textarea to the document
    document.body.appendChild(tempTextarea);

    // Select the text in the textarea
    tempTextarea.select();

    // Copy the selected text to the clipboard
    document.execCommand("copy");

    // Remove the temporary textarea
    document.body.removeChild(tempTextarea);
  }
</script>

<script>
  function createIndicator(indicatorValue) {
    const url = '/indicator/create';
    const formData = new FormData();
    formData.append('indicator', indicatorValue);
    const options = {
      method: 'POST',
      body: formData
    };

    fetch(url, options)
      .then(response => {
        if (response.ok) {
          console.log('Indicator created successfully.');
          const queryParams = `indicator_id=&indicator_name=${indicatorValue}&indicator_type=&indicator_tags=&indicator_notes=&indicator_results=&indicator_ioc_id=&created_by=`;
          window.location = `/searches?${queryParams}`;
        } else {
          console.error('Failed to create the indicator.');
        }
      })
      .catch(error => {
        console.error('An error occurred:', error);
      });
  }
</script>

{%for site in indicator.results %}

{% if "is not set in .env file" in site.results.error %}

{% elif "No results found" in site.results.error %}
<div class="ui segment">
  <p class="ui small header"><i class="fa-solid fa-circle-xmark"></i> {{site.site|snakecase_to_title}}: No results found
  </p>
</div>

{% else %}
<div class="ui segment">
  <p class="ui small header">
    <i class="fa-solid fa-circle-check"></i> <a id="{{site.site}}"></a>{{site.site|snakecase_to_title}} <button
      class="mini blue ui button" style="float: right;" onclick='CopyTextToClipboard("{{site.results}}")'>Copy
      JSON</button>
  </p>
  <div class="ui two column grid">
    {% for key,value in site.results.items() %}
    <div class="column" style="padding: 14px; word-wrap: break-word">
      <div class="ui raised fluid card">
        <div class="content">
          <button class="small ui icon button" style='float: right;' onclick='CopyTextToClipboard("{{value}}")'><i
              class="fa-solid fa-copy"></i></button>
          {% if value is string %}
          {% if value|searchable and indicator.indicator not in value %}
          <button class="small ui icon red button" style='float: right;' onclick="createIndicator('{{value}}')">
            <i class="fa-solid fa-magnifying-glass"></i>
          </button>
          {% endif %}
          {% if ("http://" in value or "https://" in value) and not key == "whois"%}
          <button class="small ui icon blue button" style='float: right;'
            onclick=" window.open('{{value}}','_blank')"><i class="fa-solid fa-link"></i></button>
          {% endif %}
          {% endif %}
          <br>
          {# Display the key as the header #}
          <p class="header">{{key|snakecase_to_title}}</p>
          {# If the value is a list, display it as a bulleted list #} {% if
          value is iterable and (value is not string and value is not
          mapping) %}
          <div class="ui bulleted list">
            {% for item in value %} {% if item is mapping %} {% for k,v in
            item.items() %}
            <div class="item"><b>{{k|capitalize}}:</b> {{v}}</div>
            {% endfor %}
            <div class="ui clearing divider"></div>
            {% else %}
            <div class="item">{{item}}</div>
            {% endif %} {% endfor %}
          </div>

          {% elif value is mapping %}
          <div class="ui bulleted list">
            {% for k,v in value.items() %}
            <div class="item"><b>{{k|capitalize}}:</b> {{v}}</div>
            {% endfor %}
          </div>

          {% else %} {# If the value is not a list, display it as a string
          #} {% if value is string and "\n" in value %}
          <div class="description">
            <pre style="word-wrap: break-word;white-space: pre-line">{{value}}</pre>
          </div>
          {% else %}
          <div class=" description">{{value}}</div>
          {% endif %} {% endif %}
        </div>
      </div>
    </div>
    {% endfor %}
  </div>
  <br />
</div>
{% endif %}
{% endfor %}